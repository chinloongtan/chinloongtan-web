{"pageProps":{"posts":[{"slug":"ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule","frontmatter":{"path":"/blog/ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule","date":"2022-01-20T15:37:00.000Z","title":"iOS Shared UserDefaults for App Extensions With RCTBridgeModule","excerpt":"Get/Set key-value from both React Native and Swift/Obj-C","tags":["react-native","ios"]},"content":"\nIn this blog post, I will share the code for a simple RCTBridgeModule that can write/read key-value from React Native.\n\nThe use case for this is to access the data in iOS Share Extension using value set from React Native.\n\nSo that the Share Extension can perform API call with sufficient data that was set in React Native, and thus giving user a much better experience similar to other natively built apps. This is a much more complicated implementation and there are much simpler ways to get it done without writing too many native code and that will be for another blog post.\n\nLet's get back and focus on this topic, get and set value in `UserDefaults` that are accesible in Share Extension.\nIn order to achieve that, we need to use `UserDefaults` with `suiteName` that starts with `group.`.\n\nBefore you proceed, please make sure that you have already created Share Extension and updated `App Groups` in the `Signing & Capabilities`.\nThis is not covered in this post and there are alot of online resources for this topic.\n\n<hr />\n\n<br />\n\n##### 1. First, create a header file in xcode.\n\nI'll name it `SharedUserDefaults.h`\n\n```\n#ifndef SharedUserDefaults_h\n#define SharedUserDefaults_h\n#endif\n\n#import <Foundation/Foundation.h>\n\n#if __has_include(<React/RCTAssert.h>)\n#import <React/RCTBridgeModule.h>\n#else\n#import \"RCTBridgeModule.h\"\n#endif\n\n@interface SharedUserDefaults : NSObject <RCTBridgeModule>\n@end\n```\n\n<br />\n\n##### 2. Then, create the implementation file.\n\n`SharedUserDefaults.m`\n\n```\n#import <Foundation/Foundation.h>\n#import \"SharedUserDefaults.h\"\n\n@implementation SharedUserDefaults\n\nRCT_EXPORT_MODULE()\n\n+ (BOOL)requiresMainQueueSetup\n{\n  return YES;\n}\n\nRCT_EXPORT_METHOD(set:(NSString *)suiteName\n                  key:(NSString *)keyName\n                  value:(NSString *)value)\n{\n  NSUserDefaults *shareExtensionDefaults = [[NSUserDefaults alloc] initWithSuiteName: suiteName];\n  [shareExtensionDefaults setObject:value forKey:keyName];\n  NSLog(@\"val written %@\", value);\n}\n\nRCT_EXPORT_METHOD(get:(NSString *)suiteName\n                  key:(NSString *)keyName\n                  resolver: (RCTPromiseResolveBlock)resolve\n                  rejecter:(RCTPromiseRejectBlock)reject)\n{\n  NSUserDefaults *shareExtensionDefaults = [[NSUserDefaults alloc] initWithSuiteName: suiteName];\n  NSString *val = [shareExtensionDefaults stringForKey:keyName];\n  if (val == nil) {\n    NSError *error = [NSError errorWithDomain:@\"org.reactjs.native.example.Bill\" code:0 userInfo:@{ @\"message\": @\"Empty\" }];\n    reject(@\"error\", @\"error description\", error);\n  } else {\n    resolve(val);\n  }\n}\n\n@end\n```\n\n<br />\n\n##### 3. Next, build and run your app.\n\nAnd you can use the methods from the native module you've just written.\n\nIn your React Native project, you can now get and set key-value pair to UserDefaults via the native module.\n\n```\nimport { NativeModules } from 'react-native';\n\nconst SharedUserDefaults = NativeModules.SharedUserDefaults;\n\n// Usage\n\n// Set\nSharedUserDefaults.set(\"group.org.reactjs.native.example.YourProject\", \"yourKey\", \"some string to be stored\");\n\n// Get\nlet val = await SharedUserDefaults.get(\"group.org.reactjs.native.example.YourProject\", \"yourKey\");\n```\n\nIn iOS, the value can be retrieved in `ShareViewController.swift` or `AppDelegate.m`.\n\n`Swift`\n\n```\nvar userDefaults = UserDefaults(suiteName: \"group.org.reactjs.native.example.YourProject\")\n\n// Get value stored earlier\nlet storedValue = userDefaults?.object(forKey: \"yourKey\") as? String\n\n // Set new value\nuserDefaults?.set(\"some string to be stored\", forKey: \"yourKey\")\n```\n\n`Obj-C`\n\n```\n  NSUserDefaults *userDefaults = [[NSUserDefaults alloc] initWithSuiteName: @\"group.org.reactjs.native.example.YourProject\"];\n\n  // Get value stored earlier\n  NSString *val = [userDefaults stringForKey:@\"yourKey\"];\n\n  // Set new value\n  [userDefaults setObject:@\"some string to be stored\" forKey:@\"yourKey\"];\n```\n\n<br />\n\n#### End\n\nYou are now all set!\n\nNow you can set value from React Native and retrieve it in your `ShareViewController.swift`.\n\nThat's it! Hope it helps.\n\nCheers.","fullPath":"/Users/chinloong/makespace/chinloongtan-web/src/content/blog/2022/01/20-shared-users-default/index.md","timeToRead":2}],"totalCount":1,"tag":"ios"},"__N_SSG":true}