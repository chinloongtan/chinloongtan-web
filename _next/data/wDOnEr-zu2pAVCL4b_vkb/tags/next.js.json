{"pageProps":{"posts":[{"slug":"migrated-my-blog-from-gatsby-to-nextjs","frontmatter":{"path":"/blog/migrated-my-blog-from-gatsby-to-nextjs","date":"2022-12-06T15:16:00.000Z","title":"Migrated my blog from Gatsby to Next.js","excerpt":"A migration checklist","tags":["next.js"]},"content":"\nMy blog were initially created with `Gastsby` and it has been easy to maintain and writing new blog posts from time to time.\nUntil recently where I am no longer able to publish new blog post unless I upgrade my project due to dependencies issues.\nMy choice was to migrate to `Next.js` because of my experience with other projects that I had set up, all using `Next.js`.\nBelow are some of the issues I faced and I decided to make a checklist out for it.\n\n<hr />\n<br />\n\n#### Migration Checklist\n\n1. Add `react`, `react-dom` and `next` packages\n\n2. Add dev dependencies `autoprefixer` and `postcss`\n\n3. Update scripts\n\n\n```\n  \"dev\": \"next dev -p 8000\",\n  \"build\": \"next build\",\n  \"start\": \"next start\",\n```\n\n4. Add `next.config.js` and `postcss.config.js`\n\n5. Rename directory `/static` to `/public`\n\n6. Move `/templates/*` to respective routes. Adapt to dynamic routes.\n\n7. Remove `graphql` query in template files\n\n8. Use `getStaticProps` to provide props previously provided by graphql.\n\n9. Use `getStaticPaths` to generate predefined blog post routes.\n\n10. Use `next/head` to replace `react-helmet` for header metadata.\n\n11. Add `react-markdown`, `gray-matter` and `highlight.js` for markdown content.\n\n12. For deployment, changes needed in `next.config.js`.\n\n```\nmodule.exports = {\n  webpack: (config, { isServer }) => {\n    config.module.rules.push(\n      {\n        test: /\\.md$/,\n        use: 'raw-loader'\n      }\n    )\n\n    return config\n  },\n  typescript: {\n    ignoreBuildErrors: true,\n  },\n  images: {\n    unoptimized: true,\n  },\n  trailingSlash: true,\n}\n```\n\n`trailingSlash` is important for `Next.js` to redirect path without ending `/`. Otherwise, the page will be redirected to `/404`\n\n`unoptimized` is set to `true` because the blog will be exported, and exported build will not enjoy the benefit of optimized image out of the box.\n\n\n13. For deployment to Github pages, add `.nojekyll` to the `/out` directory after build. So that Github pages will recognize `_next` directory and the content inside.\n\n```\n  \"deploy\": \"next build && next export && touch out/.nojekyll && gh-pages -t -d out\"\n```\n\nThe `-t` flag is important to push the changes on `.nojekyll`.\n\n<br />\n\nThat's it!\n\nCheers.\n","fullPath":"/Users/chinloong/makespace/chinloongtan-web/src/content/blog/2022/12/06-migrate-from-gatsby-to-nextjs/index.md","timeToRead":2}],"totalCount":1,"tag":"next.js"},"__N_SSG":true}