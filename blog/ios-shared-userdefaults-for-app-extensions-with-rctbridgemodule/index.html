<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/assets/favicon.png"/><meta name="keywords" content="react native, experienced, developer"/><title>Chin Loong Tan - iOS Shared UserDefaults for App Extensions With RCTBridgeModule</title><meta name="title" content="Chin Loong Tan - iOS Shared UserDefaults for App Extensions With RCTBridgeModule"/><meta name="description" content="Get/Set key-value from both React Native and Swift/Obj-C"/><meta name="next-head-count" content="10"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/d14bdf77ade3f0b5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d14bdf77ade3f0b5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-f138e9a6f25bd905.js" defer=""></script><script src="/_next/static/chunks/framework-73b8966a3c579ab0.js" defer=""></script><script src="/_next/static/chunks/main-292e4726b4fd03ef.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fcb6ce8b52eb27db.js" defer=""></script><script src="/_next/static/chunks/b2e984c5-52c564665cb02377.js" defer=""></script><script src="/_next/static/chunks/601-597bb24ff23733d9.js" defer=""></script><script src="/_next/static/chunks/675-7b1b173673ee7f53.js" defer=""></script><script src="/_next/static/chunks/518-ca43922f1257f114.js" defer=""></script><script src="/_next/static/chunks/822-db57bad4b081872d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-aec22527f36ee821.js" defer=""></script><script src="/_next/static/HXVkAtMAuKtQXwqoF7GeG/_buildManifest.js" defer=""></script><script src="/_next/static/HXVkAtMAuKtQXwqoF7GeG/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css?family=Raleway:400,500,700&display=swap">@font-face{font-family:'Raleway';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaorCIPrc.woff) format('woff')}@font-face{font-family:'Raleway';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvoorCIPrc.woff) format('woff')}@font-face{font-family:'Raleway';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVs9pbCIPrc.woff) format('woff')}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCAIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCkIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCIIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCMIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyC0IT4ttDfA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Raleway';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCAIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Raleway';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCkIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Raleway';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCIIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Raleway';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCMIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Raleway';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyC0IT4ttDfA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Raleway';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCAIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Raleway';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCkIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Raleway';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCIIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Raleway';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCMIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Raleway';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyC0IT4ttDfA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="blog-post-container content"><nav class="bg-white fixed top-0 left-0 w-full shadow flex items-center z-50" style="height:64px"><div class="relative flex-1 flex"><button type="button" class="p-4"><svg viewBox="0 0 24 24" style="width:1.5rem;height:1.5rem" role="presentation"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" style="fill:currentColor"></path></svg></button><div class="flex flex-1 text-xl font-medium items-center"><a href="/blog" class="">BLOG</a></div></div><div class="hidden md:hidden absolute bg-white w-full" style="top:64px"><a href="https://mvphub.app/" target="_blank" class="px-4 py-2 block">SHOP</a><a href="/blog" target="_self" class="px-4 py-2 block">BLOG</a><a href="/about" target="_self" class="px-4 py-2 block">ABOUT</a></div></nav><div class="p-4 md:px-16 md:py-8 lg:px-32"><h2 class="font-bold text-2xl">iOS Shared UserDefaults for App Extensions With RCTBridgeModule</h2><h6 class="text-md" style="color:#576366">20 January 2022</h6><h6 class="text-lg" style="color:#576366">Get/Set key-value from both React Native and Swift/Obj-C</h6><div style="flex-direction:row;display:flex;margin-top:10px;font-size:14px;flex-wrap:wrap"><a style="margin-right:10px;background-color:rgba(72, 52, 212, 0.3);padding:5px;padding-left:8px;padding-right:8px;border-radius:6px;font-family:Raleway;text-decoration:none;color:#4834d4" class="font-medium" href="/tags/react-native/">react-native<!-- --> </a><a style="margin-right:10px;background-color:rgba(72, 52, 212, 0.3);padding:5px;padding-left:8px;padding-right:8px;border-radius:6px;font-family:Raleway;text-decoration:none;color:#4834d4" class="font-medium" href="/tags/ios/">ios<!-- --> </a></div><hr class="my-8"/><div class="prose lg:prose-xl"><p>In this blog post, I will share the code for a simple RCTBridgeModule that can write/read key-value from React Native.</p>
<p>The use case for this is to access the data in iOS Share Extension using value set from React Native.</p>
<p>So that the Share Extension can perform API call with sufficient data that was set in React Native, and thus giving user a much better experience similar to other natively built apps. This is a much more complicated implementation and there are much simpler ways to get it done without writing too many native code and that will be for another blog post.</p>
<p>Let&#x27;s get back and focus on this topic, get and set value in <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">UserDefaults</code> that are accesible in Share Extension.
In order to achieve that, we need to use <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">UserDefaults</code> with <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">suiteName</code> that starts with <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">group.</code>.</p>
<p>Before you proceed, please make sure that you have already created Share Extension and updated <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">App Groups</code> in the <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">Signing &amp; Capabilities</code>.
This is not covered in this post and there are alot of online resources for this topic.</p>
<hr/>
<br/>
<h5>1. First, create a header file in xcode.</h5>
<p>I&#x27;ll name it <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">SharedUserDefaults.h</code></p>
<pre><code class="undefined hljs"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> SharedUserDefaults_h</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> SharedUserDefaults_h</span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-meta">#import <span class="hljs-string">&lt;Foundation/Foundation.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-keyword">if</span> __has_include(<span class="hljs-string">&lt;React/RCTAssert.h&gt;)</span></span>
<span class="hljs-meta">#import <span class="hljs-string">&lt;React/RCTBridgeModule.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
<span class="hljs-meta">#import <span class="hljs-string">&quot;RCTBridgeModule.h&quot;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">SharedUserDefaults</span> : <span class="hljs-title">NSObject</span> &lt;<span class="hljs-title">RCTBridgeModule</span>&gt;</span>
<span class="hljs-keyword">@end</span>
</code></pre>
<br/>
<h5>2. Then, create the implementation file.</h5>
<p><code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">SharedUserDefaults.m</code></p>
<pre><code class="undefined hljs"><span class="hljs-meta">#import <span class="hljs-string">&lt;Foundation/Foundation.h&gt;</span></span>
<span class="hljs-meta">#import <span class="hljs-string">&quot;SharedUserDefaults.h&quot;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">SharedUserDefaults</span></span>

RCT_EXPORT_MODULE()

+ (<span class="hljs-type">BOOL</span>)requiresMainQueueSetup
{
  <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;
}

RCT_EXPORT_METHOD(set:(<span class="hljs-built_in">NSString</span> *)suiteName
                  key:(<span class="hljs-built_in">NSString</span> *)keyName
                  value:(<span class="hljs-built_in">NSString</span> *)value)
{
  <span class="hljs-built_in">NSUserDefaults</span> *shareExtensionDefaults = [[<span class="hljs-built_in">NSUserDefaults</span> alloc] initWithSuiteName: suiteName];
  [shareExtensionDefaults setObject:value forKey:keyName];
  <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;val written %@&quot;</span>, value);
}

RCT_EXPORT_METHOD(get:(<span class="hljs-built_in">NSString</span> *)suiteName
                  key:(<span class="hljs-built_in">NSString</span> *)keyName
                  resolver: (RCTPromiseResolveBlock)resolve
                  rejecter:(RCTPromiseRejectBlock)reject)
{
  <span class="hljs-built_in">NSUserDefaults</span> *shareExtensionDefaults = [[<span class="hljs-built_in">NSUserDefaults</span> alloc] initWithSuiteName: suiteName];
  <span class="hljs-built_in">NSString</span> *val = [shareExtensionDefaults stringForKey:keyName];
  <span class="hljs-keyword">if</span> (val == <span class="hljs-literal">nil</span>) {
    <span class="hljs-built_in">NSError</span> *error = [<span class="hljs-built_in">NSError</span> errorWithDomain:<span class="hljs-string">@&quot;org.reactjs.native.example.Bill&quot;</span> code:<span class="hljs-number">0</span> userInfo:@{ <span class="hljs-string">@&quot;message&quot;</span>: <span class="hljs-string">@&quot;Empty&quot;</span> }];
    reject(<span class="hljs-string">@&quot;error&quot;</span>, <span class="hljs-string">@&quot;error description&quot;</span>, error);
  } <span class="hljs-keyword">else</span> {
    resolve(val);
  }
}

<span class="hljs-keyword">@end</span>
</code></pre>
<br/>
<h5>3. Next, build and run your app.</h5>
<p>And you can use the methods from the native module you&#x27;ve just written.</p>
<p>In your React Native project, you can now get and set key-value pair to UserDefaults via the native module.</p>
<pre><code class="undefined hljs">import { NativeModules } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;

<span class="hljs-keyword">const</span> SharedUserDefaults = NativeModules.SharedUserDefaults;

<span class="hljs-comment">// Usage</span>

<span class="hljs-comment">// Set</span>
SharedUserDefaults.<span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;group.org.reactjs.native.example.YourProject&quot;</span>, <span class="hljs-string">&quot;yourKey&quot;</span>, <span class="hljs-string">&quot;some string to be stored&quot;</span>);

<span class="hljs-comment">// Get</span>
<span class="hljs-keyword">let</span> val = <span class="hljs-keyword">await</span> SharedUserDefaults.<span class="hljs-keyword">get</span>(<span class="hljs-string">&quot;group.org.reactjs.native.example.YourProject&quot;</span>, <span class="hljs-string">&quot;yourKey&quot;</span>);
</code></pre>
<p>In iOS, the value can be retrieved in <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">ShareViewController.swift</code> or <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">AppDelegate.m</code>.</p>
<p><code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">Swift</code></p>
<pre><code class="undefined hljs"><span class="hljs-keyword">var</span> userDefaults = UserDefaults(suiteName: <span class="hljs-string">&quot;group.org.reactjs.native.example.YourProject&quot;</span>)

<span class="hljs-comment">// Get value stored earlier</span>
<span class="hljs-keyword">let</span> storedValue = userDefaults?.<span class="hljs-built_in">object</span>(forKey: <span class="hljs-string">&quot;yourKey&quot;</span>) <span class="hljs-keyword">as</span>? String

 <span class="hljs-comment">// Set new value</span>
userDefaults?.<span class="hljs-keyword">set</span>(<span class="hljs-string">&quot;some string to be stored&quot;</span>, forKey: <span class="hljs-string">&quot;yourKey&quot;</span>)
</code></pre>
<p><code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">Obj-C</code></p>
<pre><code class="undefined hljs">  <span class="hljs-built_in">NSUserDefaults</span> *userDefaults = [[<span class="hljs-built_in">NSUserDefaults</span> alloc] initWithSuiteName: <span class="hljs-string">@&quot;group.org.reactjs.native.example.YourProject&quot;</span>];

  <span class="hljs-comment">// Get value stored earlier</span>
  <span class="hljs-built_in">NSString</span> *val = [userDefaults stringForKey:<span class="hljs-string">@&quot;yourKey&quot;</span>];

  <span class="hljs-comment">// Set new value</span>
  [userDefaults setObject:<span class="hljs-string">@&quot;some string to be stored&quot;</span> forKey:<span class="hljs-string">@&quot;yourKey&quot;</span>];
</code></pre>
<br/>
<h4>End</h4>
<p>You are now all set!</p>
<p>Now you can set value from React Native and retrieve it in your <code style="background-color:rgba(0,0,0,.04);padding-top:3px;padding-bottom:3px">ShareViewController.swift</code>.</p>
<p>That&#x27;s it! Hope it helps.</p>
<p>Cheers.</p></div></div><footer class="p-4 md:p-8 lg:p-16"><div class=""><h4 class="text-xl mb-4">Contact me via:</h4><a href="https://www.linkedin.com/in/chinloongtan" target="_blank" rel="noopener noreferrer" style="color:white" class="flex items-center"><div class="w-12"><svg viewBox="0 0 24 24" style="width:2.25rem;height:2.25rem" role="presentation"><path d="M19 3A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H19M18.5 18.5V13.2A3.26 3.26 0 0 0 15.24 9.94C14.39 9.94 13.4 10.46 12.92 11.24V10.13H10.13V18.5H12.92V13.57C12.92 12.8 13.54 12.17 14.31 12.17A1.4 1.4 0 0 1 15.71 13.57V18.5H18.5M6.88 8.56A1.68 1.68 0 0 0 8.56 6.88C8.56 5.95 7.81 5.19 6.88 5.19A1.69 1.69 0 0 0 5.19 6.88C5.19 7.81 5.95 8.56 6.88 8.56M8.27 18.5V10.13H5.5V18.5H8.27Z" style="fill:currentColor"></path></svg></div>chinloongtan</a><div class="" style="margin-bottom:0;color:white"><a href="mailto:me@chinloongtan.com?body=Hi Chin Loong,
" style="color:white" class="flex items-center"><div class="w-12"><svg viewBox="0 0 24 24" style="width:2.25rem;height:2.25rem" role="presentation"><path d="M22 6C22 4.9 21.1 4 20 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6M20 6L12 11L4 6H20M20 18H4V8L12 13L20 8V18Z" style="fill:currentColor"></path></svg></div>me@chinloongtan.com</a></div></div><div class="mt-6 md:mt-16"><h4 class="text-xl mb-4">Or Buy Me A Coffee:</h4><a href="https://www.buymeacoffee.com/chinloongtan" target="_blank" rel="noopener noreferrer" style="color:white" class="flex items-center"><div class="w-12"><svg viewBox="0 0 24 24" style="width:2.25rem;height:2.25rem" role="presentation"><path d="M2,21V19H20V21H2M20,8V5H18V8H20M20,3A2,2 0 0,1 22,5V8A2,2 0 0,1 20,10H18V13A4,4 0 0,1 14,17H8A4,4 0 0,1 4,13V3H20M16,5H6V13A2,2 0 0,0 8,15H14A2,2 0 0,0 16,13V5Z" style="fill:currentColor"></path></svg></div>chinloongtan</a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\nIn this blog post, I will share the code for a simple RCTBridgeModule that can write/read key-value from React Native.\n\nThe use case for this is to access the data in iOS Share Extension using value set from React Native.\n\nSo that the Share Extension can perform API call with sufficient data that was set in React Native, and thus giving user a much better experience similar to other natively built apps. This is a much more complicated implementation and there are much simpler ways to get it done without writing too many native code and that will be for another blog post.\n\nLet's get back and focus on this topic, get and set value in `UserDefaults` that are accesible in Share Extension.\nIn order to achieve that, we need to use `UserDefaults` with `suiteName` that starts with `group.`.\n\nBefore you proceed, please make sure that you have already created Share Extension and updated `App Groups` in the `Signing \u0026 Capabilities`.\nThis is not covered in this post and there are alot of online resources for this topic.\n\n\u003chr /\u003e\n\n\u003cbr /\u003e\n\n##### 1. First, create a header file in xcode.\n\nI'll name it `SharedUserDefaults.h`\n\n```\n#ifndef SharedUserDefaults_h\n#define SharedUserDefaults_h\n#endif\n\n#import \u003cFoundation/Foundation.h\u003e\n\n#if __has_include(\u003cReact/RCTAssert.h\u003e)\n#import \u003cReact/RCTBridgeModule.h\u003e\n#else\n#import \"RCTBridgeModule.h\"\n#endif\n\n@interface SharedUserDefaults : NSObject \u003cRCTBridgeModule\u003e\n@end\n```\n\n\u003cbr /\u003e\n\n##### 2. Then, create the implementation file.\n\n`SharedUserDefaults.m`\n\n```\n#import \u003cFoundation/Foundation.h\u003e\n#import \"SharedUserDefaults.h\"\n\n@implementation SharedUserDefaults\n\nRCT_EXPORT_MODULE()\n\n+ (BOOL)requiresMainQueueSetup\n{\n  return YES;\n}\n\nRCT_EXPORT_METHOD(set:(NSString *)suiteName\n                  key:(NSString *)keyName\n                  value:(NSString *)value)\n{\n  NSUserDefaults *shareExtensionDefaults = [[NSUserDefaults alloc] initWithSuiteName: suiteName];\n  [shareExtensionDefaults setObject:value forKey:keyName];\n  NSLog(@\"val written %@\", value);\n}\n\nRCT_EXPORT_METHOD(get:(NSString *)suiteName\n                  key:(NSString *)keyName\n                  resolver: (RCTPromiseResolveBlock)resolve\n                  rejecter:(RCTPromiseRejectBlock)reject)\n{\n  NSUserDefaults *shareExtensionDefaults = [[NSUserDefaults alloc] initWithSuiteName: suiteName];\n  NSString *val = [shareExtensionDefaults stringForKey:keyName];\n  if (val == nil) {\n    NSError *error = [NSError errorWithDomain:@\"org.reactjs.native.example.Bill\" code:0 userInfo:@{ @\"message\": @\"Empty\" }];\n    reject(@\"error\", @\"error description\", error);\n  } else {\n    resolve(val);\n  }\n}\n\n@end\n```\n\n\u003cbr /\u003e\n\n##### 3. Next, build and run your app.\n\nAnd you can use the methods from the native module you've just written.\n\nIn your React Native project, you can now get and set key-value pair to UserDefaults via the native module.\n\n```\nimport { NativeModules } from 'react-native';\n\nconst SharedUserDefaults = NativeModules.SharedUserDefaults;\n\n// Usage\n\n// Set\nSharedUserDefaults.set(\"group.org.reactjs.native.example.YourProject\", \"yourKey\", \"some string to be stored\");\n\n// Get\nlet val = await SharedUserDefaults.get(\"group.org.reactjs.native.example.YourProject\", \"yourKey\");\n```\n\nIn iOS, the value can be retrieved in `ShareViewController.swift` or `AppDelegate.m`.\n\n`Swift`\n\n```\nvar userDefaults = UserDefaults(suiteName: \"group.org.reactjs.native.example.YourProject\")\n\n// Get value stored earlier\nlet storedValue = userDefaults?.object(forKey: \"yourKey\") as? String\n\n // Set new value\nuserDefaults?.set(\"some string to be stored\", forKey: \"yourKey\")\n```\n\n`Obj-C`\n\n```\n  NSUserDefaults *userDefaults = [[NSUserDefaults alloc] initWithSuiteName: @\"group.org.reactjs.native.example.YourProject\"];\n\n  // Get value stored earlier\n  NSString *val = [userDefaults stringForKey:@\"yourKey\"];\n\n  // Set new value\n  [userDefaults setObject:@\"some string to be stored\" forKey:@\"yourKey\"];\n```\n\n\u003cbr /\u003e\n\n#### End\n\nYou are now all set!\n\nNow you can set value from React Native and retrieve it in your `ShareViewController.swift`.\n\nThat's it! Hope it helps.\n\nCheers.","frontmatter":{"path":"/blog/ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule","date":"2022-01-20T15:37:00.000Z","title":"iOS Shared UserDefaults for App Extensions With RCTBridgeModule","excerpt":"Get/Set key-value from both React Native and Swift/Obj-C","tags":["react-native","ios"]},"fullPath":"/Users/chinloong/makespace/chinloongtan-web/src/content/blog/2022/01/20-shared-users-default/index.md","timeToRead":2}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule"},"buildId":"HXVkAtMAuKtQXwqoF7GeG","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>