<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><link rel="shortcut icon" href="/assets/favicon.png"/><title>Chin Loong Tan</title><meta name="title" content="Chin Loong Tan"/><meta name="description" content="React Native developer"/><meta name="keywords" content="react native, experienced, developer"/><meta name="next-head-count" content="10"/><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/35ffbb7db43c57ce.css" as="style"/><link rel="stylesheet" href="/_next/static/css/35ffbb7db43c57ce.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-36d12a75f0098f30.js" defer=""></script><script src="/_next/static/chunks/framework-36098b990598bc0c.js" defer=""></script><script src="/_next/static/chunks/main-a3243aca410ca0a4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b00c40279445f1ea.js" defer=""></script><script src="/_next/static/chunks/143-bce4362c624c1079.js" defer=""></script><script src="/_next/static/chunks/767-da6754476d7b0d7f.js" defer=""></script><script src="/_next/static/chunks/pages/tags/%5Btag%5D-67144d67f59f61ac.js" defer=""></script><script src="/_next/static/J6dDzyXelxc9G-MQ0HKQA/_buildManifest.js" defer=""></script><script src="/_next/static/J6dDzyXelxc9G-MQ0HKQA/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css?family=Raleway:300,400">@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVuEorCIPrc.woff) format('woff')}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptxg8zYS_SKggPN4iEgvnHyvveLxVvaorCIPrc.woff) format('woff')}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCAIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCkIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCIIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCMIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Raleway';font-style:normal;font-weight:300;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyC0IT4ttDfA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCAIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCkIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCIIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyCMIT4ttDfCmxA.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Raleway';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/raleway/v28/1Ptug8zYS_SKggPNyC0IT4ttDfA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div class="blog-posts content"><div class="custom-nav"><style data-emotion="css k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="MuiBox-root css-k008qs"><style data-emotion="css 13x2oq7">.css-13x2oq7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#1976d2;color:#fff;}@media print{.css-13x2oq7{position:absolute;}}</style><style data-emotion="css 5poeop">.css-5poeop{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#1976d2;color:#fff;}@media print{.css-5poeop{position:absolute;}}</style><nav class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionFixed mui-fixed css-5poeop" style="background-color:white"><style data-emotion="css i6s8oy">.css-i6s8oy{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-i6s8oy{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-i6s8oy{min-height:48px;}}}@media (min-width:600px){.css-i6s8oy{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-i6s8oy"><style data-emotion="css er9axy">.css-er9axy{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;margin-left:-12px;color:black;}.css-er9axy:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-er9axy:hover{background-color:transparent;}}.css-er9axy.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css zo9a81">.css-zo9a81{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;margin-left:-12px;color:black;}.css-zo9a81::-moz-focus-inner{border-style:none;}.css-zo9a81.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-zo9a81{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-zo9a81:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-zo9a81:hover{background-color:transparent;}}.css-zo9a81.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-edgeStart MuiIconButton-sizeMedium css-zo9a81" tabindex="0" type="button" aria-label="back"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIcon"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg></button><style data-emotion="css 13ge1hf">.css-13ge1hf{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:1.25rem;line-height:1.6;letter-spacing:0.0075em;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (min-width:600px){.css-13ge1hf{display:block;}}</style><div class="MuiTypography-root MuiTypography-h6 css-13ge1hf"><a style="color:black;font-family:Raleway;text-decoration:none" href="/">TAGS/ios</a></div></div></nav><nav class="MuiBox-root css-0"><style data-emotion="css 12acf6p">.css-12acf6p{z-index:1200;}@media (min-width:0px){.css-12acf6p{display:block;}}@media (min-width:600px){.css-12acf6p{display:none;}}.css-12acf6p .MuiDrawer-paper{box-sizing:border-box;width:240px;}</style></nav></div></div><div style="margin-left:20px">1 post tagged with &quot;ios&quot;<br/><a href="/tags/">View all tags</a></div><div class="row"><div class="blog-post-preview col-md-8 offset-md-2"><a style="color:black" class="blog-post-preview-link" href="/blog/ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule/"><h4>iOS Shared UserDefaults for App Extensions With RCTBridgeModule</h4><h6 style="color:#576366">2022-01-20T15:37:00.000Z</h6><div><span style="color:#576366">Get/Set key-value from both React Native and Swift/Obj-C</span><span style="float:right">2<!-- --> min read</span></div><div style="flex-direction:row;display:flex;margin-top:10px;font-size:14px;flex-wrap:wrap"><a style="margin-right:10px;background-color:rgba(72, 52, 212, 0.3);padding:5px;padding-left:8px;padding-right:8px;border-radius:6px;font-weight:bold;font-family:Raleway;text-decoration:none;color:#4834d4" href="/tags/react-native/">react-native<!-- --> </a><a style="margin-right:10px;background-color:rgba(72, 52, 212, 0.3);padding:5px;padding-left:8px;padding-right:8px;border-radius:6px;font-weight:bold;font-family:Raleway;text-decoration:none;color:#4834d4" href="/tags/ios/">ios<!-- --> </a></div></a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"slug":"ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule","frontmatter":{"path":"/blog/ios-shared-userdefaults-for-app-extensions-with-rctbridgemodule","date":"2022-01-20T15:37:00.000Z","title":"iOS Shared UserDefaults for App Extensions With RCTBridgeModule","excerpt":"Get/Set key-value from both React Native and Swift/Obj-C","tags":["react-native","ios"]},"content":"\nIn this blog post, I will share the code for a simple RCTBridgeModule that can write/read key-value from React Native.\n\nThe use case for this is to access the data in iOS Share Extension using value set from React Native.\n\nSo that the Share Extension can perform API call with sufficient data that was set in React Native, and thus giving user a much better experience similar to other natively built apps. This is a much more complicated implementation and there are much simpler ways to get it done without writing too many native code and that will be for another blog post.\n\nLet's get back and focus on this topic, get and set value in `UserDefaults` that are accesible in Share Extension.\nIn order to achieve that, we need to use `UserDefaults` with `suiteName` that starts with `group.`.\n\nBefore you proceed, please make sure that you have already created Share Extension and updated `App Groups` in the `Signing \u0026 Capabilities`.\nThis is not covered in this post and there are alot of online resources for this topic.\n\n\u003chr /\u003e\n\n\u003cbr /\u003e\n\n##### 1. First, create a header file in xcode.\n\nI'll name it `SharedUserDefaults.h`\n\n```\n#ifndef SharedUserDefaults_h\n#define SharedUserDefaults_h\n#endif\n\n#import \u003cFoundation/Foundation.h\u003e\n\n#if __has_include(\u003cReact/RCTAssert.h\u003e)\n#import \u003cReact/RCTBridgeModule.h\u003e\n#else\n#import \"RCTBridgeModule.h\"\n#endif\n\n@interface SharedUserDefaults : NSObject \u003cRCTBridgeModule\u003e\n@end\n```\n\n\u003cbr /\u003e\n\n##### 2. Then, create the implementation file.\n\n`SharedUserDefaults.m`\n\n```\n#import \u003cFoundation/Foundation.h\u003e\n#import \"SharedUserDefaults.h\"\n\n@implementation SharedUserDefaults\n\nRCT_EXPORT_MODULE()\n\n+ (BOOL)requiresMainQueueSetup\n{\n  return YES;\n}\n\nRCT_EXPORT_METHOD(set:(NSString *)suiteName\n                  key:(NSString *)keyName\n                  value:(NSString *)value)\n{\n  NSUserDefaults *shareExtensionDefaults = [[NSUserDefaults alloc] initWithSuiteName: suiteName];\n  [shareExtensionDefaults setObject:value forKey:keyName];\n  NSLog(@\"val written %@\", value);\n}\n\nRCT_EXPORT_METHOD(get:(NSString *)suiteName\n                  key:(NSString *)keyName\n                  resolver: (RCTPromiseResolveBlock)resolve\n                  rejecter:(RCTPromiseRejectBlock)reject)\n{\n  NSUserDefaults *shareExtensionDefaults = [[NSUserDefaults alloc] initWithSuiteName: suiteName];\n  NSString *val = [shareExtensionDefaults stringForKey:keyName];\n  if (val == nil) {\n    NSError *error = [NSError errorWithDomain:@\"org.reactjs.native.example.Bill\" code:0 userInfo:@{ @\"message\": @\"Empty\" }];\n    reject(@\"error\", @\"error description\", error);\n  } else {\n    resolve(val);\n  }\n}\n\n@end\n```\n\n\u003cbr /\u003e\n\n##### 3. Next, build and run your app.\n\nAnd you can use the methods from the native module you've just written.\n\nIn your React Native project, you can now get and set key-value pair to UserDefaults via the native module.\n\n```\nimport { NativeModules } from 'react-native';\n\nconst SharedUserDefaults = NativeModules.SharedUserDefaults;\n\n// Usage\n\n// Set\nSharedUserDefaults.set(\"group.org.reactjs.native.example.YourProject\", \"yourKey\", \"some string to be stored\");\n\n// Get\nlet val = await SharedUserDefaults.get(\"group.org.reactjs.native.example.YourProject\", \"yourKey\");\n```\n\nIn iOS, the value can be retrieved in `ShareViewController.swift` or `AppDelegate.m`.\n\n`Swift`\n\n```\nvar userDefaults = UserDefaults(suiteName: \"group.org.reactjs.native.example.YourProject\")\n\n// Get value stored earlier\nlet storedValue = userDefaults?.object(forKey: \"yourKey\") as? String\n\n // Set new value\nuserDefaults?.set(\"some string to be stored\", forKey: \"yourKey\")\n```\n\n`Obj-C`\n\n```\n  NSUserDefaults *userDefaults = [[NSUserDefaults alloc] initWithSuiteName: @\"group.org.reactjs.native.example.YourProject\"];\n\n  // Get value stored earlier\n  NSString *val = [userDefaults stringForKey:@\"yourKey\"];\n\n  // Set new value\n  [userDefaults setObject:@\"some string to be stored\" forKey:@\"yourKey\"];\n```\n\n\u003cbr /\u003e\n\n#### End\n\nYou are now all set!\n\nNow you can set value from React Native and retrieve it in your `ShareViewController.swift`.\n\nThat's it! Hope it helps.\n\nCheers.","fullPath":"/Users/chinloong/makespace/chinloongtan-web/src/content/blog/2022/01/20-shared-users-default/index.md","timeToRead":2}],"totalCount":1,"tag":"ios"},"__N_SSG":true},"page":"/tags/[tag]","query":{"tag":"ios"},"buildId":"J6dDzyXelxc9G-MQ0HKQA","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>